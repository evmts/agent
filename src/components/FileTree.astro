---
import type { TreeEntry } from "../lib/types";

interface Props {
  tree: TreeEntry[];
  user: string;
  repo: string;
  branch: string;
  path?: string;
}

const { tree, user, repo, branch, path = "" } = Astro.props;

// Sort: directories first, then files alphabetically
const sorted = [...tree].sort((a, b) => {
  if (a.type === b.type) return a.name.localeCompare(b.name);
  return a.type === "tree" ? -1 : 1;
});

function getUrl(entry: TreeEntry) {
  const basePath = path ? `${path}/${entry.name}` : entry.name;
  if (entry.type === "tree") {
    return `/${user}/${repo}/tree/${branch}/${basePath}`;
  }
  return `/${user}/${repo}/blob/${branch}/${basePath}`;
}

function getIcon(entry: TreeEntry) {
  return entry.type === "tree" ? "▸" : "·";
}
---

<div class="file-tree">
  {sorted.length === 0 ? (
    <div class="empty-state">
      <p>No files in this directory</p>
    </div>
  ) : (
    sorted.map((entry) => (
      <a
        href={getUrl(entry)}
        class:list={["file-tree-item", { directory: entry.type === "tree" }]}
      >
        <span class="icon">{getIcon(entry)}</span>
        <span class="name">{entry.name}</span>
      </a>
    ))
  )}
</div>
